<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title><%=blog.name%> - <%=(yield(:subtitle) || yield(:title) || "Welcome").gsub(/<.*>/, '')%></title>
    <link rel="alternate" type="application/atom+xml" title="<%=blog.name%> - ATOM" href="<%=atom_feed_url%>" />
    <link rel="alternate" type="application/rss+xml" title="<%=blog.name%> - RSS" href="<%=rss_feed_url%>" />
    <%=defined?(pingback_link_tag) ? pingback_link_tag : ''%>
    <%=stylesheet_link_tag 'blog/layout'%>
    <%=stylesheet_link_tag 'blog/sidebars'%>
    <%=stylesheet_link_tag 'blog/syntax_highlighting'%>
    <%=stylesheet_link_tag 'boastful'%>
    <%=tiny_mce :editor_selector => "tiny_mce", :relative_urls => false, :remove_script_host => false%>
    <%=javascript_include_tag :defaults%>
    <%=javascript_include_tag 'jquery.min.js'%>
    <%=javascript_include_tag 'jquery.boastful.js'%>
    <%=calendar_date_select_includes "blue"%>
    <%SIDEBARS.each { |sidebar| if File.exist?(File.join(RAILS_ROOT, "public/stylesheets/blog/sidebars/#{sidebar}.css")) -%>
        <%=stylesheet_link_tag "blog/sidebars/#{sidebar}"%>
    <%end }%>
    <%=yield :head%>
    
    <script type="text/javascript">
      //<![CDATA[
      Event.observe(window, 'load', function() {
        <%=yield :after_load%>
      });
      //]]>
    </script>
  </head>

  <body>
    <div id="outer">
      <div id="border-top-left">&nbsp;</div>
      <div id="border-top-right">&nbsp;</div>
      <div id="border-top-middle">&nbsp;</div>
      <div id="border-center">
        <div id="sidebar">
          <%SIDEBARS.each do |sidebar|%>
            <div class='sidebar_item'>
              <div class='top'></div>
              <div class='content'>
                <div id="<%=sidebar%>">
                  <%=render :partial => "sidebars/#{sidebar}"%>
                </div>
              </div>
              <div class='bottom'></div>
            </div>
          <%end%>
        </div>

        <div id="content">
          <div id="collapse-sidebar" onclick="toggleSidebar();"></div>
          <div id="inner-content">
            <div id="inner-top-content">
              <div id="post-info">
                <div id="titlebar">
                  <%if title = yield(:title)%>
                    <span id="gohome">
                      <a href='/'>TiC</a>
                    </span>
                    <%=title%>
                  <%else%>
                    <span id="blog_name_link">
                      <%=link_to blog.name, root_path%>
                      <%if permitted_to? :edit, :blogs%>
                        [<%=link_to_function "edit", "Element.toggle('blog_name_link');Element.toggle('blog_name_form');"%>]
                      <%end%>
                    </span>
                    <span id="blog_owner">
                      with <%=link_to blog.owner.name, author_path%>
                    </span>
                    <%if permitted_to? :edit, :blogs%>
                      <span id="blog_name_form" style='display:none;'>
                        <%form_for blog do |f|%>
                          <%=f.text_field :name%>
                          <%=f.submit%>
                        <%end%>
                      </span>
                    <%end%>
                  <%end%>
                </div>
                <%if content_given?(:subtitle)%>
                  <div id="subtitle">
                    <%=yield :subtitle%>
                  </div>
                <%end%>
                <%if content_given?(:extra_info)%>
                  <div id="caption">
                    <%=yield :extra_info%>
                  </div>
                <%end%>
              </div>
            </div>
            
            <%if content_given?(:extra_info)%><div id="spacer">&nbsp;</div><%end%>
    
            <div id="flash">
              <%flash.each do |name, msg|%>
                <%=content_tag :div, msg, :id => "flash_#{name}"%>
              <%end%>
            </div>
    
            <div id="main">
              <%=yield%>
    
              <%if tweetbacks?%>
                <div id="boastful-container">
                  <div id="boastful" style="float:left;"></div>
                  <div id="boastful2"></div>
                </div>
                <div style='clear:both;'></div>
              <%end%>
              
              <div id="post-comments">
                <%=yield :post_comments%>
              </div>
              
              <div id="post-comments-form">
                <%=yield :post_comments_form%>
              </div>
            </div>
          </div>
          
        </div>
      </div>
      <div id="border-bottom-left">&nbsp;</div>
      <div id="border-bottom-right">&nbsp;</div>
      <div id="border-bottom-middle">&nbsp;</div>
      <div id="fake-bottom"></div>
      
    
      <div style='position:absolute;z-index:-1;top:10px;opacity:0;' id="sidebar-scroll-mirror">
        &nbsp;
        <%#
          This is because if the sidebar is longer than the main content, we don't get
          scrollbars using position:fixed. So we mirror it with a position:absolute
          of equal height in the background.
        
          FIXME: Since this element is positioned absolutely, the sidebars can extend beyond
            the #outer element.
        %>
      </div>
    </div>
  </body>
</html>
